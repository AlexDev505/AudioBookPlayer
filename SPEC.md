# AudioBook Player 

## Общие сведения
- полное наименование системы и ее условное обозначение: _**AudioBook Player**_ (_**AB Player**_)
- срок начала работы: _**день до дедлайна**_
- срок окончания проекта: _**15 ноября 2021 г.**_

## Требования
Создать Desktop приложение для скачивания и прослушивания аудио книг, 
используя язык программирования _Python_ и фреймворк _Qt_, а именно Python библиотеку _Pyqt5_.

### Структура приложения

#### Модуль для работы с базой данных
Создать пакет Python для взаимодействия с базой данных, 
используя такую Python библиотеку как [_sqlite3-api_](https://github.com/AlexDev-py/sqlite3_api).

Необходимо описать такие таблицы как:
- Books
- Settings

При описании таблицы _Books_ нужно реализовать класс _Book_, 
описывающий основные данные о книге 
(_автор_,
_название_,
_описание_,
_чтец_,
_длительность_,
_ссылка на книгу_,
_ссылка на обложку_,
_главы_,
_драйвер, который использовался при получении сведений о книге_)
и класс _Books_, являющийся потомком класса _Book_, но имеющий дополнительные поля, а именно 
_статус книги_,
_точка остановки прослушивания_ и
_флаг, отмечающий книгу как "Избранная"_.

Для описания _списка глав_, _статуса книги_, _точки остановки_ и _флага "Избранное"_ 
следует создать соответствующие классы, которые должны быть наследниками _sqlite3_api.field_types.FieldType_.

При инициализации данного пакета в переменных окружения должна создаваться определенная переменная, 
содержащая путь к файлу базы данных, 
а так же должны создаваться выше указанные таблицы.

#### Модуль для парсинга данных с сайтов
Создать масштабируемый Python пакет драйверов, 
реализующих сбор данных с различных сайтов с аудио книгами, 
используя Python библиотеку [_selenium_](https://github.com/baijum/selenium-python).

Для лучшей масштабируемости следует создать:
- _базовый класс драйвера_ в котором будут определены абстрактные методы для получения информации о книгах, 
а так же метод для скачивания аудио файлов 
- _базовый класс для обработки процесса скачивания книги_, содержащий метод для отображения прогресса, 
- который можно будет переопределить в дочерних классах.

Так же в этом пакете должны быть реализованы инструменты для обновления драйвера браузера.

#### Интерфейс
Пакет должен содержать классы, в которых описан интерфейс приложения и
файлы ресурсов (картинки и таблицы стилей).


Нужно реализовать 2 класса, которые будут использоваться как главные окна(_QMainWindow_):
- Окно запуска приложения, на котором будут отображаться: 
  - Загрузочная анимация
  - Статус загрузки
- Главное окно приложения. Окно должно делиться на 3 основные части:
    Меню должно иметь способность плавно сворачиваться и разворачиваться(изменять размер). 
    В меню должны присутствовать такие разделы как:
    - Библиотека
    - Избранные книги
    - Поиск книг
    - Настойки
    
    Разделы представляют собой кнопки, с иконкой и текстом.
  - Мини плеер. Должен располагаться у нижней границы окна, 
    и растягиваться по горизонтали от меню до правого края окна. 
    Эта часть окна должна быть разделена на левую и правую части. 
  
    У левого края области будут располагаться:
    - уменьшенная обложка книги
    - кнопка pause/play
    
    В правой части:
    - регулятор громкости. Изначально это должна быть кнопка, 
      при нажатии на которую справа от нее плавно появляется регулятор громкости(QSlider) 
      и метка(QLabel), отображающая значение(целое число от 0 до 100), 
      при повторном нажатии регулятор так же плавно скрывается. 
      При изменении значения должна меняться иконка кнопки.
    - регулятор скорости. Реализуется так же как регулятор громкости, 
      но отображаемое значение будет в диапазоне от -100% до +100% (при 0% отображается _1x_)
      (регулятор громкости и скорости не могут быть открыты одновременно, 
      если открыт один, при попытке открыть другой, первый закрывается, и наоборот).
    - кнопка перехода в режим оверлея(поверх всех окон).
    - полоса загрузки(индикатор прогресса скачивания книги). 
      При наведении на этот виджет должна появляться всплывающая подсказка, 
      сообщающая точный размер скачанных данных.
  - Область контента - QStackedWidget, содержащий в себе такие страницы как:
    - Библиотека. Область будет разделена на 2 части. 
      - Слева - панель фильтрации. Здесь должны быть реализованы:
        - Строка поиска
        - Сортировка по дате добавления/названию/автору
        - Выбор одного автора
        
        Панель фильтрации должна иметь фиксированный размер(не иметь растягиваться и уменьшаться), 
        а так же способность плавно сворачиваться/разворачиваться.
      - Всю остальную область должна занимать библиотека(QTabWidget) с вкладками 
        _"Все книги"_, _"В процессе прослушивания"_ и _"Прослушанные"_. 
        В этих разделах будет отображаться либо прокручиваемая область(QScrollArea), 
        либо сообщение о том, что список пуст.
      
      Библиотека будет являться начальным экраном(открываться при старте приложения). 
      (если нет книги в процессе прослушивания)
    - Страница книги. Слева сверху страницы должно отображаться текст вида "<автор> - <название книги>". 
      Рядом прогресс прослушивания, и кнопка для его изменения. 
      Напротив(Справа сверху) группа кнопок, в числе которых:
      - Отметить книгу как "Избранная"(Иконка кнопки должна меняться в зависимости от значения флага)
      - Скачать книгу
      - Удалить книгу
      - Изменить источник книги

      Все эти кнопки представляют собой иконки без текста.
      
      Ниже расположен плеер, а именно обложка книги, и StackedWidget, имеющий страницы:
      - Плеер.
        - Кнопка pause/play
        - Кнопки для перемотки времени(по 15 секунд)
        - список глав(QScrollArea)
      - Страница для скачивания книги. Эта страница будет открываться, если книга не скачана. 
        На этой странице должно находиться сообщение о необходимости скачать книгу
        и еще одна кнопка для скачивания(с текстом).
      - Страница прогресса скачивания. Страница открывается, когда запущен процесс скачивания **этой** книги. 
        Здесь будет расположен еще одна полоса загрузки и кнопка отмены скачивания.
      
      Плеер должен иметь максимальную высоту(не иметь возможности растягиваться и сжиматься по вертикали)

      Далее, занимая всё оставшееся место располагается описание книги:
      - Автор
      - Название
      - Чтец
      - Продолжительность
      - Полное описание(QTextEdit)
    - Страница поиска книги. На этой странице по центру должна располагаться строка ввода и кнопка поиска, 
      а так же текст "Поиск книги".
    - Страница информации. На этой странице по центру должен располагаться пустой QLabel и пустая кнопка под ним.
    - Страница настроек. Здесь должны быть формы выбора цветовой схемы, 
      устройства вывода звука, смены папки с книгами.
- Окно оверлея, содержащее мини плеер.

А так же 2 класса, которые будут использоваться как виджеты(_QWidget_):
- Виджет книги. Будет использоваться в главном окне на странице библиотеки. Эти виджеты должны содержать:
  - обложку книги
  - название
  - автора
  - чтеца
  - прогресс прослушивания
  - продолжительность
  - обрезанное описание
  - Кнопки:
    - удаление книги
    - пометить как "Избранное"
- Виджет главы. Представляет собой QSlider, 
  поверх которого расположено название главы, продолжительность и текущее время.

#### Функции интерфейса
В этом пакете должны содержаться все функции, выполняемые интерфейсом.
Функции должны быть разделены по файлам.

- Страница поиска
  - Функция поиска. Вызывается при нажатии на кнопку поиска на странице добавления новой книги. 
    Функция должна открывать страницу загрузки(страницу информации, но помещать туда анимацию загрузки). 
    Функция должна проверять введённые данные на корректность, 
    сопоставляя доступные драйвера с введённой ссылкой. 
    Непосредственно поиск книги необходимо производить в отдельном потоке, 
    для этого нужно реализовать соответствующий класс, который при удачном поиске, 
    будет открывать страницу найденной книги, а в случае ошибки, 
    переводить пользователя на страницу информации, и предлагать открыть ссылку в браузере.
- Страница книги
  - Функция загрузки обложки. Вызывается при открытии страницы книги, библиотеки и других обстоятельствах. 
    Функция должна проверять, скачана ли обложка книги, если да, 
    то установить ее в переданный аргументом QLabel. Если же обложка не скачана, 
    нужно проверить указана ли ссылка на нее в переданном экземпляре _Book_, 
    если нет, то нужно скрыть указанный QLabel, иначе установить в QLabel индикатор загрузки, 
    и в отдельном потоке скачать обложку. При успешном скачивании, сохранить картинку в кэш, 
    если книга скачана, сохранить картинку в соответствующую книге папку и установить обложку в QLabel. 
    При возникновении ошибки при скачивании, просто скрыть указанный QLabel.
  - Функция скачивания книги. Вызывается при нажатии на соответствующие кнопки на странице книги. 
    Функция должна проверять идёт ли скачивание другой книги, если да, 
    то попросить пользователя дождаться окончания загрузки, иначе начать скачивание книги в отдельном потоке, 
    скрыв кнопки для скачивания и открыв страницу прогресса скачивания. 
    При успешном скачивании книги, она должна добавиться в базу данных. 
    Если открыта страница скачиваемой книги, нужно ее обновить, если открыта библиотека, то обновить ее содержимое. 
    При ошибке скачивания, открыть страницу информации, отобразив ошибку и предложив вернуться в библиотеку. 
    (Так же по завершению скачивания, нужно скрыть полосу загрузки, находящуюся в мини плеере)
  - Функция удаления книги. Вызывается при нажатии на соответствующие кнопки на странице книги или в библиотеке. 
    Перед началом удаления нужно попросить у пользователя подтверждения действия, 
    и только после его согласия, открыть страницу загрузки и запустить процесс удаления в отдельном потоке. 
    Нужно удалить как запись в базе данных, так и скачанные файлы, вместе с папкой. 
    При успешном завершении процесса нужно открыть страницу библиотеки, 
    иначе страницу информации, отобразив ошибку и предложив вернуться в библиотеку.
  - Функция остановки скачивания. Вызывается при нажатии на соответствующую кнопку на странице книги. 
    Функция должна запросить у пользователя подтверждение действия, 
    и после подтверждения нужно открыть страницу загрузки и запустить процесс удаления книги в отдельном потоке, 
    выполнив те же операции, что указаны выше.
  - Функция добавления/удаления книги из "Избранного". 
    Вызывается при нажатии на соответствующие кнопки на странице книги или в библиотеке. 
    Изменяет состояние соответствующего флага у книги, сохраняя изменения в базе данных,
    а так же изменяет иконку нажатой кнопки.
  - функция изменения источника. Вызывается при нажатии на соответствующую кнопку на странице книги. 
    После подтверждения действия, создает диалог с пользователем, прося ввести его ссылку на другой источник книги. 
    Функция должна проверить корректность данных, сопоставив доступные драйвера, 
    а так же проверить не является ли введённая ссылка, старым источником. 
    После этого нужно открыть страницу загрузки. И запустить процесс удаления книги в отдельном потоке. 
    При успешном удалении, запустить процесс получения данных о новой книге. 
    Далее открыть страницу книги и начать скачивание. При ошибках и успехах действовать так же как описано выше.
  - Функция изменения прогресса прослушивания. Вызывается при нажатии на соответствующую кнопку на странице книги. 
    После подтверждения действия, нужно изменить статус книги. С прослушанного на не прослушанное и наоборот.
  - Функция подготовки полосы загрузки. Вызывается при открытии приложения. 
    Наделяет обычную полосу загрузки особыми свойствами. Позволяет динамически изменять всплывающую подсказку.
- Контент(StackedWidget)
  - Функция изменения страницы. Дополняет стандартный метод. 
    При переходе со страницы скачиваемой книги разворачивает полосу загрузки в мини плеере, и обратное. 
    Снимает ограничения по размеру окна, при переходе со страницы библиотеки.
- Панель управления(Мини плеер)
  - Функция обработки нажатия кнопки в группе кнопок. 
    Запускает соответствующие функции, в зависимости от нажатой кнопки.
  - Функция сворачивания/разворачивания регулятора скорости. 
    Вызывает функцию _сворачивания/разворачивания регулятора громкости_, если тот открыт 
    и запускает анимацию сворачивания/разворачивания регулятора скорости.
  - Функция сворачивания/разворачивания регулятора громкости. 
    Вызывает функцию _сворачивания/разворачивания регулятора скорости_, если тот открыт 
    и запускает анимацию сворачивания/разворачивания регулятора громкости.
  - Функция обработки изменения значения регулятора громкости. 
    Изменяет громкость воспроизводимого аудио файла, меняет значение на метке, а так же изменяет иконку на кнопке.
  - Функция обработки изменения значения регулятора скорости. 
    Изменяет скорость воспроизводимого аудио файла, меняет значение на метке.
- Панель фильтрации
  - Функция сброса отбора по автору.
  - Функция изменения порядка сортировки. Изменяет иконку на нажатой кнопке.
- Библиотека
  - Функция сворачивания/разворачивания меню фильтрации. Запускает соответствующую анимацию.
- Библиотека
  - Функция сворачивания/разворачивания меню. Запускает соответствующую анимацию.
  - Функция обработки нажатия кнопки в группе кнопок. 
    Выполняет определенные действия и открывает соответствующую страницу.
- Регуляторы(QSlider)
  - Функция обработки нажатия на QSlider. Реализует мгновенное изменение значения при нажатии. 
    Включает флаг, сообщающий о зажатии левой кнопки мыши.
  - Функция обработки отпускания мыши. Выключает вышеуказанный флаг.
  - Функция обработки движения мыши с зажатой левой кнопкой по QSlider. 
    Улучшает стандартную функцию изменения значения, по средству движения мыши с зажатой кнопкой.

Интерфейс приложения должен иметь собственную рамку, 
при этом должен сохранить возможность перемещения и масштабирования окна.
